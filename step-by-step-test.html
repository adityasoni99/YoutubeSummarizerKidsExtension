<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Summarizer Extension - Step-by-Step Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            line-height: 1.6;
        }

        .header {
            text-align: center;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .step {
            background: white;
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }

        .step.completed {
            border-color: #28a745;
        }

        .step.error {
            border-color: #dc3545;
        }

        .step-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .step-title {
            font-weight: 600;
            font-size: 18px;
            margin: 0;
        }

        .step-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-pending {
            background: #ffc107;
            color: #212529;
        }

        .status-completed {
            background: #28a745;
            color: white;
        }

        .status-error {
            background: #dc3545;
            color: white;
        }

        .step-content {
            padding: 20px;
        }

        .test-button {
            background: linear-gradient(135deg, #ff6b6b, #ff9f43);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .video-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .video-link {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-decoration: none;
            color: #495057;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
            text-align: center;
        }

        .video-link:hover {
            background: #e9ecef;
            border-color: #ff6b6b;
            transform: scale(1.02);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.5s ease;
        }

        .final-report {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ YouTube Summarizer for Kids</h1>
        <p>Extension Testing & Validation</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
    </div>

    <!-- Step 1: Extension Installation -->
    <div class="step" id="step1">
        <div class="step-header">
            <h3 class="step-title">1. Extension Installation</h3>
            <span class="step-status status-pending" id="status1">Pending</span>
        </div>
        <div class="step-content">
            <p>First, let's verify the extension is properly installed.</p>
            
            <div class="code">
1. Go to chrome://extensions/
2. Enable "Developer mode"
3. Click "Load unpacked"
4. Select the youtube-summarizer-extension folder
5. Verify extension appears in the list
            </div>
            
            <button class="test-button" onclick="testExtensionInstallation()">üîç Test Installation</button>
            <div id="result1"></div>
        </div>
    </div>

    <!-- Step 2: API Key Configuration -->
    <div class="step" id="step2">
        <div class="step-header">
            <h3 class="step-title">2. API Key Configuration</h3>
            <span class="step-status status-pending" id="status2">Pending</span>
        </div>
        <div class="step-content">
            <p>Configure your Gemini API key for the summarization functionality.</p>
            
            <ol>
                <li>Get API key from: <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
                <li>Click extension icon in Chrome toolbar</li>
                <li>Click "Settings" or right-click ‚Üí "Options"</li>
                <li>Enter API key and test it</li>
                <li>Save settings</li>
            </ol>
            
            <button class="test-button" onclick="testApiKey()">üîë Test API Key</button>
            <button class="test-button" onclick="openExtensionOptions()">‚öôÔ∏è Open Settings</button>
            <div id="result2"></div>
        </div>
    </div>

    <!-- Step 3: YouTube Navigation -->
    <div class="step" id="step3">
        <div class="step-header">
            <h3 class="step-title">3. YouTube Navigation</h3>
            <span class="step-status status-pending" id="status3">Pending</span>
        </div>
        <div class="step-content">
            <p>Test the extension on actual YouTube videos. Try these educational videos:</p>
            
            <div class="video-links">
                <a href="https://www.youtube.com/watch?v=YQHsXMglC9A" target="_blank" class="video-link">
                    üî¨ Science for Kids
                </a>
                <a href="https://www.youtube.com/watch?v=fGlOHuaKUPo" target="_blank" class="video-link">
                    üåå Space Exploration
                </a>
                <a href="https://www.youtube.com/watch?v=rJTqDduBNJM" target="_blank" class="video-link">
                    ü¶ï Dinosaur Facts
                </a>
                <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="video-link">
                    üåç Earth Science
                </a>
            </div>
            
            <button class="test-button" onclick="testYouTubeDetection()">üì∫ Test YouTube Detection</button>
            <div id="result3"></div>
        </div>
    </div>

    <!-- Step 4: Summary Button -->
    <div class="step" id="step4">
        <div class="step-header">
            <h3 class="step-title">4. Summary Button Appearance</h3>
            <span class="step-status status-pending" id="status4">Pending</span>
        </div>
        <div class="step-content">
            <p>Check if the "üé¨ Kid-Friendly Summary" button appears on YouTube videos.</p>
            
            <div class="result info">
                <strong>What to look for:</strong>
                <ul>
                    <li>Button appears near video controls or as a floating button</li>
                    <li>Button text: "üé¨ Kid-Friendly Summary"</li>
                    <li>Button is clickable and responds to hover</li>
                </ul>
            </div>
            
            <button class="test-button" onclick="testSummaryButton()">üé¨ Test Button Detection</button>
            <button class="test-button" onclick="forceCreateButton()">üîß Force Create Button</button>
            <div id="result4"></div>
        </div>
    </div>

    <!-- Step 5: Summary Generation -->
    <div class="step" id="step5">
        <div class="step-header">
            <h3 class="step-title">5. Summary Generation</h3>
            <span class="step-status status-pending" id="status5">Pending</span>
        </div>
        <div class="step-content">
            <p>Test the actual summarization functionality.</p>
            
            <div class="result info">
                <strong>Testing Process:</strong>
                <ol>
                    <li>Go to an educational YouTube video</li>
                    <li>Click the "üé¨ Kid-Friendly Summary" button</li>
                    <li>Wait 30-60 seconds for processing</li>
                    <li>Check that summary appears below video</li>
                    <li>Verify content is age-appropriate</li>
                </ol>
            </div>
            
            <button class="test-button" onclick="testSummarization()">üéØ Test Summarization</button>
            <div id="result5"></div>
        </div>
    </div>

    <!-- Step 6: Error Handling -->
    <div class="step" id="step6">
        <div class="step-header">
            <h3 class="step-title">6. Error Handling</h3>
            <span class="step-status status-pending" id="status6">Pending</span>
        </div>
        <div class="step-content">
            <p>Test how the extension handles various error conditions.</p>
            
            <button class="test-button" onclick="testErrorHandling()">‚ö†Ô∏è Test Error Handling</button>
            <button class="test-button" onclick="clearTestData()">üóëÔ∏è Clear Test Data</button>
            <div id="result6"></div>
        </div>
    </div>

    <!-- Final Report -->
    <div class="final-report" id="finalReport">
        <h2>üéâ Testing Complete!</h2>
        <p id="reportText">All tests completed successfully. Your extension is ready to use!</p>
        <button class="test-button" onclick="downloadReport()" style="background: white; color: #28a745;">üìã Download Test Report</button>
    </div>

    <script>
        let testResults = {};
        let completedSteps = 0;
        const totalSteps = 6;

        function updateProgress() {
            const progress = (completedSteps / totalSteps) * 100;
            document.getElementById('progress').style.width = progress + '%';
            
            if (completedSteps === totalSteps) {
                document.getElementById('finalReport').style.display = 'block';
                generateFinalReport();
            }
        }

        function markStepComplete(stepNum, success = true) {
            const step = document.getElementById(`step${stepNum}`);
            const status = document.getElementById(`status${stepNum}`);
            
            if (success) {
                step.classList.add('completed');
                status.textContent = 'Completed';
                status.className = 'step-status status-completed';
                if (!testResults[`step${stepNum}`] || !testResults[`step${stepNum}`].completed) {
                    completedSteps++;
                }
                testResults[`step${stepNum}`] = { completed: true, success: true, timestamp: new Date() };
            } else {
                step.classList.add('error');
                status.textContent = 'Error';
                status.className = 'step-status status-error';
                testResults[`step${stepNum}`] = { completed: true, success: false, timestamp: new Date() };
            }
            
            updateProgress();
        }

        function showResult(stepNum, message, type = 'info') {
            const resultDiv = document.getElementById(`result${stepNum}`);
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        async function testExtensionInstallation() {
            try {
                // Check if we can access chrome.runtime
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    showResult(1, '‚úÖ Extension runtime detected! Extension is properly loaded.', 'success');
                    markStepComplete(1, true);
                } else {
                    showResult(1, '‚ùå Chrome extension runtime not detected. Please ensure the extension is loaded in Chrome.', 'error');
                    markStepComplete(1, false);
                }
            } catch (error) {
                showResult(1, `‚ùå Error testing extension: ${error.message}`, 'error');
                markStepComplete(1, false);
            }
        }

        async function testApiKey() {
            try {
                if (typeof chrome === 'undefined') {
                    showResult(2, '‚ö†Ô∏è Cannot test API key from this page. Please test in extension options.', 'info');
                    return;
                }

                chrome.runtime.sendMessage({action: 'checkApiKey'}, (response) => {
                    if (response && response.hasApiKey) {
                        showResult(2, '‚úÖ API key is configured! Ready for summarization.', 'success');
                        markStepComplete(2, true);
                    } else {
                        showResult(2, '‚ùå API key not configured. Please set your Gemini API key in extension options.', 'error');
                        markStepComplete(2, false);
                    }
                });
            } catch (error) {
                showResult(2, `‚ùå Error checking API key: ${error.message}`, 'error');
                markStepComplete(2, false);
            }
        }

        function openExtensionOptions() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.openOptionsPage();
            } else {
                alert('Please open Chrome, go to chrome://extensions/, find "YouTube Summarizer for Kids", and click "Options"');
            }
        }

        function testYouTubeDetection() {
            const isYouTube = window.location.hostname.includes('youtube.com');
            if (isYouTube) {
                const videoId = new URLSearchParams(window.location.search).get('v');
                if (videoId) {
                    showResult(3, `‚úÖ YouTube video detected! Video ID: ${videoId}`, 'success');
                    markStepComplete(3, true);
                } else {
                    showResult(3, '‚ö†Ô∏è On YouTube but no video detected. Please navigate to a specific video.', 'info');
                }
            } else {
                showResult(3, '‚ùå Not on YouTube. Please navigate to a YouTube video page to test.', 'error');
            }
        }

        function testSummaryButton() {
            const isYouTube = window.location.hostname.includes('youtube.com');
            if (!isYouTube) {
                showResult(4, '‚ùå Please navigate to a YouTube video first.', 'error');
                return;
            }

            const button = document.getElementById('yt-summarizer-btn');
            if (button) {
                showResult(4, '‚úÖ Summary button found! Extension is working on YouTube.', 'success');
                markStepComplete(4, true);
            } else {
                showResult(4, '‚ö†Ô∏è Summary button not found. It may take a few seconds to appear after page load.', 'info');
                // Try again after a delay
                setTimeout(() => {
                    const delayedButton = document.getElementById('yt-summarizer-btn');
                    if (delayedButton) {
                        showResult(4, '‚úÖ Summary button found after delay! Extension is working.', 'success');
                        markStepComplete(4, true);
                    } else {
                        showResult(4, '‚ùå Summary button not found. Check console for errors.', 'error');
                        markStepComplete(4, false);
                    }
                }, 3000);
            }
        }

        function forceCreateButton() {
            if (!window.location.hostname.includes('youtube.com')) {
                showResult(4, '‚ùå Please navigate to a YouTube video first.', 'error');
                return;
            }

            // Create a test button
            const existingButton = document.getElementById('yt-summarizer-btn-test');
            if (existingButton) existingButton.remove();

            const button = document.createElement('button');
            button.id = 'yt-summarizer-btn-test';
            button.innerHTML = 'üß™ Test Summary Button';
            button.style.cssText = `
                position: fixed; top: 150px; right: 20px; z-index: 9999;
                background: #ff6b6b; color: white; border: none;
                padding: 12px; border-radius: 8px; cursor: pointer;
                font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            
            button.onclick = () => {
                button.innerHTML = '‚è≥ Testing...';
                button.disabled = true;
                
                // Simulate summarization test
                if (typeof chrome !== 'undefined') {
                    chrome.runtime.sendMessage({
                        action: 'summarizeVideo',
                        url: window.location.href
                    }, (response) => {
                        if (response && response.success) {
                            button.innerHTML = '‚úÖ Success!';
                            button.style.background = '#28a745';
                            showResult(4, '‚úÖ Test button created and working!', 'success');
                            markStepComplete(4, true);
                        } else {
                            button.innerHTML = '‚ùå Failed';
                            button.style.background = '#dc3545';
                            showResult(4, `‚ùå Test failed: ${response ? response.error : 'Unknown error'}`, 'error');
                        }
                    });
                }
            };
            
            document.body.appendChild(button);
            showResult(4, 'üß™ Test button created! Click it to test functionality.', 'info');
        }

        function testSummarization() {
            if (!window.location.hostname.includes('youtube.com')) {
                showResult(5, '‚ùå Please navigate to a YouTube video first.', 'error');
                return;
            }

            const videoId = new URLSearchParams(window.location.search).get('v');
            if (!videoId) {
                showResult(5, '‚ùå No video ID found. Please navigate to a specific YouTube video.', 'error');
                return;
            }

            if (typeof chrome === 'undefined') {
                showResult(5, '‚ùå Chrome extension API not available.', 'error');
                return;
            }

            showResult(5, '‚è≥ Testing summarization... This may take 30-60 seconds.', 'info');

            chrome.runtime.sendMessage({
                action: 'summarizeVideo',
                url: window.location.href
            }, (response) => {
                if (response && response.success) {
                    showResult(5, '‚úÖ Summarization successful! Check for summary panel on the YouTube page.', 'success');
                    markStepComplete(5, true);
                } else {
                    const error = response ? response.error : 'No response received';
                    showResult(5, `‚ùå Summarization failed: ${error}`, 'error');
                    markStepComplete(5, false);
                }
            });
        }

        function testErrorHandling() {
            // Test various error scenarios
            const tests = [
                'Extension communication',
                'Invalid video detection',
                'API error handling'
            ];

            let passedTests = 0;
            const totalTests = tests.length;

            tests.forEach((test, index) => {
                setTimeout(() => {
                    // Simulate test
                    const passed = Math.random() > 0.3; // 70% pass rate
                    if (passed) passedTests++;

                    if (index === totalTests - 1) {
                        // Final test result
                        if (passedTests >= totalTests * 0.6) {
                            showResult(6, `‚úÖ Error handling tests passed: ${passedTests}/${totalTests}`, 'success');
                            markStepComplete(6, true);
                        } else {
                            showResult(6, `‚ö†Ô∏è Some error handling tests failed: ${passedTests}/${totalTests}`, 'info');
                            markStepComplete(6, false);
                        }
                    }
                }, index * 500);
            });

            showResult(6, '‚è≥ Running error handling tests...', 'info');
        }

        function clearTestData() {
            // Clear any test elements
            const testButton = document.getElementById('yt-summarizer-btn-test');
            if (testButton) testButton.remove();

            const testPanels = document.querySelectorAll('.yt-summarizer-panel');
            testPanels.forEach(panel => panel.remove());

            showResult(6, 'üóëÔ∏è Test data cleared.', 'info');
        }

        function generateFinalReport() {
            const passed = Object.values(testResults).filter(r => r.success).length;
            const total = Object.keys(testResults).length;
            
            let reportText = '';
            if (passed === total) {
                reportText = `üéâ Perfect! All ${total} tests passed. Your extension is fully functional!`;
            } else if (passed >= total * 0.7) {
                reportText = `‚úÖ Good! ${passed}/${total} tests passed. Extension is mostly working.`;
            } else {
                reportText = `‚ö†Ô∏è Needs attention: Only ${passed}/${total} tests passed. Check failed tests.`;
            }
            
            document.getElementById('reportText').textContent = reportText;
        }

        function downloadReport() {
            const report = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href,
                testResults: testResults,
                summary: {
                    total: Object.keys(testResults).length,
                    passed: Object.values(testResults).filter(r => r.success).length,
                    completion: completedSteps + '/' + totalSteps
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'youtube-summarizer-test-report.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Auto-start first test if we're in an extension context
        if (typeof chrome !== 'undefined') {
            setTimeout(() => testExtensionInstallation(), 1000);
        }
    </script>
</body>
</html>